---
title: 小程序页面切换的本质
date: 2024-10-30 20:56:03
tags: ["小程序"]
categories: 
    - ["前端"]
    - ["小程序"]
top_img: https://img0.baidu.com/it/u=3291332156,2373920352&fm=253&fmt=auto&app=138&f=JPEG?w=890&h=500
cover: https://img2.baidu.com/it/u=534490904,3498620580&fm=253&fmt=auto&app=120&f=JPEG?w=750&h=500
---

# **小程序页面切换本质**

在微信小程序中，页面切换的本质可以归结为 **页面栈的管理** 和 **视图的重新渲染**。微信小程序通过一个栈来管理用户的页面跳转，当用户在不同页面之间切换时，小程序会将每个页面的路由推入或弹出页面栈，从而实现页面切换。具体分为以下几个方面：

## **1. 页面栈管理**

小程序在内存中维护了一个页面栈来管理当前活动的页面和之前访问过的页面。页面栈可以理解为一个数据结构，其中栈底是最先加载的页面，栈顶是当前活动的页面。

### **a. push 新页面到页面栈**

当用户从一个页面导航到另一个页面时（如通过 `wx.navigateTo`），新的页面会被推入到页面栈的顶部。旧页面仍然保留在栈中，等待用户返回时恢复。

### **b. pop 出页面**

当用户通过 `wx.navigateBack` 返回上一个页面时，当前页面会从栈顶弹出，被销毁，之前的页面成为新的栈顶并重新渲染。

### **c. replace 当前页面**

通过 `wx.redirectTo`，当前页面会被替换，新的页面不会被推入页面栈，而是替换当前页面，这时页面栈的大小保持不变。

### **d. 重设页面栈**

通过 `wx.reLaunch`，可以清空页面栈并加载一个新的页面，这常用于重置应用或重新启动页面流程。

## **2. 页面栈管理API**

- **`wx.navigateTo`**：在当前页面栈中打开一个新页面，保留当前页面。当栈中页面超过 10 个时，会自动销毁最早的页面。
- **`wx.redirectTo`**：关闭当前页面，跳转到应用内的某个页面，不会产生页面栈推入操作。
- **`wx.switchTab`**：切换到 tabBar 页面，关闭其他非 tabBar 页面。
- **`wx.navigateBack`**：关闭当前页面，返回上一个页面或多级页面。
- **`wx.reLaunch`**：关闭所有页面，打开一个新的页面，页面栈被完全重置。

## **3. 视图的重新渲染**

每次页面切换时，新的页面加载并渲染，而旧页面在切换后可能被销毁或保留在内存中。

### **a. 生命周期函数**

小程序页面切换过程中，页面的生命周期函数会被触发，开发者可以在这些生命周期钩子中处理逻辑：

- **`onLoad`**：页面加载时调用，仅在页面首次加载时触发。
- **`onShow`**：页面显示时调用，每次切换到该页面时触发。
- **`onHide`**：页面隐藏时调用，如跳转到其他页面时会触发。
- **`onUnload`**：页面卸载时调用，如页面被从页面栈中移除时触发。

### **b. 缓存与销毁**

如果页面栈中的页面没有被销毁，当用户返回该页面时，只会触发 `onShow`，而不会重新加载整个页面。这意味着页面的状态在页面栈中的保留时间取决于页面是否被销毁。

## **4. 性能考虑**

微信小程序会对页面栈的数量进行限制（最多10个页面），以避免占用过多内存。当页面栈中的页面数量超过限制时，最早的页面会被销毁。因此，页面切换的本质不仅是栈的管理，还有内存和性能优化的考虑。

## **5. 与传统 Web 页面切换的区别**

与传统 Web 页面切换不同，微信小程序的页面切换并不会刷新整个应用程序，而是通过维护页面栈和局部更新视图来实现。这种模式使得页面切换更加轻量，不需要重新加载整个应用，提升了小程序的性能和用户体验。

---

## **总结**

微信小程序页面切换的本质是通过 **页面栈的管理** 来完成的。不同的跳转方式（如 `navigateTo`、`redirectTo`、`reLaunch`）影响页面栈的行为，从而影响页面的加载与卸载。同时，页面的生命周期钩子提供了对页面状态的管理方式，确保视图在切换时得到适当的渲染和更新。